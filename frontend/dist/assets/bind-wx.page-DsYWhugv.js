import{s as Q}from"./index-BlrXpyIG.js";import{F as b,G as k,H as B,a as L,s as V,I as $}from"./service.provider-C67_Sx9f.js";import{d as E,r as o,L as M,o as N,X as W,b as D,e as c,G as w,J as h,E as f,S as y,f as a,g as t,D as F}from"./index-B5ZzjzoS.js";import{Q as O}from"./qrcode.vue.esm-ETQildk8.js";const X={class:"w-full flex justify-center items-center p-4 flex-col"},j={class:"flex flex-col items-center justify-center"},q={class:"relative inline-block mb-2"},G={key:0,class:"text-center ml-4 mr-4 text-sm"},H={key:1,class:"text-sm"},J={key:0,class:"text-center mt-2"},Z=E({__name:"bind-wx.page",setup(R){const T=W(),x=o(""),u=o(!1),l=o(null),r=o(null),s=o(""),n=o(""),{localStorageWxtoken:I,userInfo:C}=M();N(()=>{b()===!1&&(localStorage.getItem("xbx-client-uuid")!==null?s.value=localStorage.getItem("xbx-client-uuid")||"":(s.value=k(),localStorage.setItem("xbx-client-uuid",s.value)),n.value=k(),p())});const p=()=>{u.value=!1,s&&n&&(x.value=`https://api.quantclass.cn/user/authorize?client_id=${s.value}&nonce=${n.value}&action=&ignore=0&r=${Math.random()}`,S(),U())},S=()=>{g(),l.value=setTimeout(()=>{u.value=!0,d()},5*60*1e3)},g=()=>{l.value&&(clearTimeout(l.value),l.value=null)},U=()=>{d(),_()},_=async()=>{var m;try{const e=await B(s.value,n.value);if(e.result===!0&&((m=e==null?void 0:e.data)!=null&&m.token)){const v=e.data.token;I.value=v;const i=await L();if(i.result===!0){C.value=JSON.stringify(i.data),T.replace("/dataCenter");return}}}catch(e){console.error("轮询请求失败:",e);return}r.value=setTimeout(_,3e3)},d=()=>{r.value&&(clearTimeout(r.value),r.value=null)};return D(()=>{g(),d()}),(m,e)=>{const v=V,i=Q;return a(),c("div",X,[w(i,{class:"w-full max-w-sm sm:max-w-md py-4 sm:py-8 shadow-lg"},{header:f(()=>e[1]||(e[1]=[t("div",{class:"text-2xl font-semibold text-center"},"微信登录",-1)])),content:f(()=>[t("div",j,[t("div",q,[w(O,{class:"w-50 h-50 sm:w-60 sm:h-60 p-2 rounded-lg bg-white",value:x.value,level:"H","render-as":"svg"},null,8,["value"]),u.value?(a(),F(v,{key:0,class:"absolute inset-0 bg-black/50 backdrop-blur-sm hover:bg-black/60 focus:ring-2 focus:ring-offset-2 focus:ring-black border-0",onClick:e[0]||(e[0]=z=>p())},{default:f(()=>e[2]||(e[2]=[t("div",{className:"text-white"},[t("i",{class:"pi pi-refresh text-3xl mx-auto mb-4"}),t("div",null,"二维码失效"),t("div",null,"请点击刷新")],-1)])),_:1,__:[2]})):h("",!0)]),y($)()===!0?(a(),c("div",G," 截图二维码打开微信扫一扫，授权登录后，返回浏览器 ")):(a(),c("div",H,"打开微信，扫描上方二维码登录"))])]),_:1}),y(b)()===!0?(a(),c("div",J," 请在pc浏览器或手机浏览器打开该页面 ")):h("",!0)])}}});export{Z as default};
