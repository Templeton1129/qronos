import{s as V}from"./index-BlrXpyIG.js";import{j as M,B as j,m as L,A as z,e as E,f as I,F as Q,M as $,K as H,G as x,O as W,H as X,d as _,Q as q,L as J,r as C,o as Z,c as Y,D as R,J as ee,E as k,X as te,g as o,W as ne,_ as B}from"./index-B5ZzjzoS.js";import{s as ae,a as oe}from"./index-DTisTy3U.js";import{g as re,i as se,s as le,b as U,a as ie}from"./service.provider-C67_Sx9f.js";import{Q as ue}from"./qrcode.vue.esm-ETQildk8.js";var ce=M`
    .p-inputotp {
        display: flex;
        align-items: center;
        gap: dt('inputotp.gap');
    }

    .p-inputotp-input {
        text-align: center;
        width: dt('inputotp.input.width');
    }

    .p-inputotp-input.p-inputtext-sm {
        text-align: center;
        width: dt('inputotp.input.sm.width');
    }

    .p-inputotp-input.p-inputtext-lg {
        text-align: center;
        width: dt('inputotp.input.lg.width');
    }
`,pe={root:"p-inputotp p-component",pcInputText:"p-inputotp-input"},de=j.extend({name:"inputotp",style:ce,classes:pe}),fe={name:"BaseInputOtp",extends:oe,props:{readonly:{type:Boolean,default:!1},tabindex:{type:Number,default:null},length:{type:Number,default:4},mask:{type:Boolean,default:!1},integerOnly:{type:Boolean,default:!1}},style:de,provide:function(){return{$pcInputOtp:this,$parentInstance:this}}},F={name:"InputOtp",extends:fe,inheritAttrs:!1,emits:["change","focus","blur"],data:function(){return{tokens:[]}},watch:{modelValue:{immediate:!0,handler:function(e){this.tokens=e?e.split(""):new Array(this.length)}}},methods:{getTemplateAttrs:function(e){return{value:this.tokens[e]}},getTemplateEvents:function(e){var n=this;return{input:function(u){return n.onInput(u,e)},keydown:function(u){return n.onKeyDown(u)},focus:function(u){return n.onFocus(u)},blur:function(u){return n.onBlur(u)},paste:function(u){return n.onPaste(u)}}},onInput:function(e,n){this.tokens[n]=e.target.value,this.updateModel(e),e.inputType==="deleteContentBackward"?this.moveToPrev(e):(e.inputType==="insertText"||e.inputType==="deleteContentForward"||L()&&e instanceof CustomEvent)&&this.moveToNext(e)},updateModel:function(e){var n=this.tokens.join("");this.writeValue(n,e),this.$emit("change",{originalEvent:e,value:n})},moveToPrev:function(e){var n=this.findPrevInput(e.target);n&&(n.focus(),n.select())},moveToNext:function(e){var n=this.findNextInput(e.target);n&&(n.focus(),n.select())},findNextInput:function(e){var n=e.nextElementSibling;if(n)return n.nodeName==="INPUT"?n:this.findNextInput(n)},findPrevInput:function(e){var n=e.previousElementSibling;if(n)return n.nodeName==="INPUT"?n:this.findPrevInput(n)},onFocus:function(e){e.target.select(),this.$emit("focus",e)},onBlur:function(e){this.$emit("blur",e)},onClick:function(e){setTimeout(function(){return e.target.select()},1)},onKeyDown:function(e){if(!(e.ctrlKey||e.metaKey))switch(e.code){case"ArrowLeft":this.moveToPrev(e),e.preventDefault();break;case"ArrowUp":case"ArrowDown":e.preventDefault();break;case"Backspace":e.target.value.length===0&&(this.moveToPrev(e),e.preventDefault());break;case"ArrowRight":this.moveToNext(e),e.preventDefault();break;case"Enter":case"NumpadEnter":case"Tab":break;default:(this.integerOnly&&!(e.code!=="Space"&&Number(e.key)>=0&&Number(e.key)<=9)||this.tokens.join("").length>=this.length&&e.code!=="Delete")&&e.preventDefault();break}},onPaste:function(e){var n=e.clipboardData.getData("text");if(n.length){var c=n.substring(0,this.length);(!this.integerOnly||!isNaN(c))&&(this.tokens=c.split(""),this.updateModel(e))}e.preventDefault()}},computed:{inputMode:function(){return this.integerOnly?"numeric":"text"},inputType:function(){return this.mask?"password":"text"}},components:{OtpInputText:ae}};function me(t,e,n,c,u,r){var l=z("OtpInputText");return I(),E("div",X({class:t.cx("root")},t.ptmi("root")),[(I(!0),E(Q,null,$(t.length,function(s){return H(t.$slots,"default",{key:s,events:r.getTemplateEvents(s-1),attrs:r.getTemplateAttrs(s-1),index:s},function(){return[x(l,{value:u.tokens[s-1],type:r.inputType,class:W(t.cx("pcInputText")),name:t.$formName,inputmode:r.inputMode,variant:t.variant,readonly:t.readonly,disabled:t.disabled,size:t.size,invalid:t.invalid,tabindex:t.tabindex,unstyled:t.unstyled,onInput:function(g){return r.onInput(g,s-1)},onFocus:e[0]||(e[0]=function(d){return r.onFocus(d)}),onBlur:e[1]||(e[1]=function(d){return r.onBlur(d)}),onPaste:e[2]||(e[2]=function(d){return r.onPaste(d)}),onKeydown:e[3]||(e[3]=function(d){return r.onKeyDown(d)}),onClick:e[4]||(e[4]=function(d){return r.onClick(d)}),pt:t.ptm("pcInputText")},null,8,["value","type","class","name","inputmode","variant","readonly","disabled","size","invalid","tabindex","unstyled","onInput","pt"])]})}),128))],16)}F.render=me;const ge=""+new URL("google_play-N2cWJKDm.png",import.meta.url).href,ve=""+new URL("app-store-DxXaD0uQ.png",import.meta.url).href;var S,G;function ye(){return G||(G=1,S=function(){var t=document.getSelection();if(!t.rangeCount)return function(){};for(var e=document.activeElement,n=[],c=0;c<t.rangeCount;c++)n.push(t.getRangeAt(c));switch(e.tagName.toUpperCase()){case"INPUT":case"TEXTAREA":e.blur();break;default:e=null;break}return t.removeAllRanges(),function(){t.type==="Caret"&&t.removeAllRanges(),t.rangeCount||n.forEach(function(u){t.addRange(u)}),e&&e.focus()}}),S}var N,K;function he(){if(K)return N;K=1;var t=ye(),e={"text/plain":"Text","text/html":"Url",default:"Text"},n="Copy to clipboard: #{key}, Enter";function c(r){var l=(/mac os x/i.test(navigator.userAgent)?"⌘":"Ctrl")+"+C";return r.replace(/#{\s*key\s*}/g,l)}function u(r,l){var s,d,g,v,y,i,T=!1;l||(l={}),s=l.debug||!1;try{g=t(),v=document.createRange(),y=document.getSelection(),i=document.createElement("span"),i.textContent=r,i.ariaHidden="true",i.style.all="unset",i.style.position="fixed",i.style.top=0,i.style.clip="rect(0, 0, 0, 0)",i.style.whiteSpace="pre",i.style.webkitUserSelect="text",i.style.MozUserSelect="text",i.style.msUserSelect="text",i.style.userSelect="text",i.addEventListener("copy",function(m){if(m.stopPropagation(),l.format)if(m.preventDefault(),typeof m.clipboardData>"u"){s&&console.warn("unable to use e.clipboardData"),s&&console.warn("trying IE specific stuff"),window.clipboardData.clearData();var w=e[l.format]||e.default;window.clipboardData.setData(w,r)}else m.clipboardData.clearData(),m.clipboardData.setData(l.format,r);l.onCopy&&(m.preventDefault(),l.onCopy(m.clipboardData))}),document.body.appendChild(i),v.selectNodeContents(i),y.addRange(v);var D=document.execCommand("copy");if(!D)throw new Error("copy command was unsuccessful");T=!0}catch(m){s&&console.error("unable to copy using execCommand: ",m),s&&console.warn("trying IE specific stuff");try{window.clipboardData.setData(l.format||"text",r),l.onCopy&&l.onCopy(window.clipboardData),T=!0}catch(w){s&&console.error("unable to copy using clipboardData: ",w),s&&console.error("falling back to prompt"),d=c("message"in l?l.message:n),window.prompt(d,r)}}finally{y&&(typeof y.removeRange=="function"?y.removeRange(v):y.removeAllRanges()),i&&document.body.removeChild(i),g()}return T}return N=u,N}var be=he();const xe=re(be),we={class:"w-full flex justify-center items-center p-4"},ke={class:"space-y-2 text-sm"},Te={class:"space-y-1 sm:space-y-2"},Ie={class:"flex justify-center"},Ce={class:"flex items-center justify-center space-x-2"},De={class:"px-3 py-1 bg-gray-100 dark:bg-neutral-800 rounded text-sm font-mono tracking-wider"},Ae={class:"space-y-1 sm:space-y-2"},Se={class:"relative flex justify-center items-center"},Ne={class:"relative flex justify-center items-center mb-2"},Ue=_({__name:"login.page",setup(t){const e=te(),n=q(),{gaToken:c,sessionGAtoken:u,userInfo:r,localStorageWxtoken:l}=J(),s=C(""),d=C(""),g=C(""),v=C(null);Z(()=>{y(),T()});const y=async()=>{const p=await se();p.result===!0&&p.data!==null&&(v.value=p.data,p.data===!0&&i())},i=()=>{c.value=null,u.value=null,l.value=null,r.value=null},T=()=>{if(v.value===!1)return;const p=localStorage.getItem("ga-secret-key");if(p)s.value=p;else{let f="";const h="ABCDEFGHIJKLMNOPQRSTUVWXYZ234567";for(let b=0;b<16;b++)f+=h.charAt(Math.floor(Math.random()*h.length));s.value=f,localStorage.setItem("ga-secret-key",f)}const a=encodeURIComponent(s.value);d.value=`otpauth://totp/QRONOSUI:${a}?secret=${a}&issuer=QRONOSUI`},D=()=>{xe(s.value),n.add({severity:"success",summary:"复制成功",life:3e3})},m=Y(()=>g.value.length===6),w=async()=>{var p;if(s.value&&m.value){const a=await U(g.value,s.value);if(a.result===!0){let f=a.data;localStorage.removeItem("ga-secret-key"),P(((p=f.data.data)==null?void 0:p.access_token)||"",f)}}},O=async()=>{var p;if(m.value){const a=await U(g.value);if(a.result===!0){let f=a.data;localStorage.removeItem("ga-secret-key"),P(((p=f.data.data)==null?void 0:p.access_token)||"",f)}}},P=async(p,a)=>{var f;if(c.value=p,u.value=p,(f=a.config.url)!=null&&f.includes("/login")){const h=a.headers["xbx-Authorization"]||a.headers["xbx-authorization"]||a.headers["XBX-AUTHORIZATION"];if(l.value=h,h){const b=await ie();b.result===!0&&(r.value=JSON.stringify(b.data),e.replace("/dataCenter")),g.value=""}else{r.value=null,e.replace("/bindWx");return}}};return(p,a)=>{const f=le,h=F,b=V;return I(),E("div",we,[v.value!==null&&v.value===!0?(I(),R(b,{class:"w-full max-w-sm sm:max-w-md shadow-lg",key:"first-bind"},{header:k(()=>a[2]||(a[2]=[o("div",{class:"text-2xl font-semibold text-center mt-5"},"谷歌登录",-1)])),content:k(()=>[o("div",ke,[a[7]||(a[7]=o("div",{class:"space-y-1 sm:space-y-2"},[o("div",{class:"font-semibold"},"1. 请下载Google Authenticator"),o("p",{class:"text-xs"},'     Google Authenticator是一个动态密码工具，绑定后每次生成一个30秒更新一次的动态验证码， 用于登录安全验证。iOS用户登录AppStore，搜索"Authenticator"即可下载，而对于Android用户登录Google Play或使用手机浏览器搜索“Google Authenticator”下载。 '),o("div",{class:"h-10 flex justify-center items-center space-x-8"},[o("a",{href:"https://play.google.com/store/apps/details?id=com.google.android.apps.authenticator2",target:"_blank",class:"h-full"},[o("img",{src:ge,alt:"Google Play",class:"h-full"})]),o("a",{href:"https://apps.apple.com/us/app/google-authenticator/id388497605",target:"_blank",class:"h-full"},[o("img",{src:ve,alt:"App Store",class:"h-full"})])])],-1)),o("div",Te,[a[4]||(a[4]=o("div",{class:"font-semibold"},"2. 扫描二维码或手动输入密钥",-1)),a[5]||(a[5]=o("p",{class:"text-xs"},"     打开Google Authenticator，扫描下方二维码或手动输入下方密钥添加验证令牌。密钥可用于在手机更换或丢失时验证Google Authenticator。请务必在绑定前备份以下密钥。 ",-1)),o("div",Ie,[x(ue,{class:"w-35 h-35 p-2 border border-gray-200 rounded-lg bg-white",value:d.value,level:"H","render-as":"svg"},null,8,["value"])]),o("div",Ce,[a[3]||(a[3]=o("span",{class:"text-sm font-mediu"},"密钥:",-1)),o("span",De,ne(s.value),1),x(f,{icon:"pi pi-copy",size:"small","aria-label":"复制",onClick:D})])]),o("div",Ae,[a[6]||(a[6]=o("div",{class:"font-semibold"},"3.请输入谷歌验证器中的验证码",-1)),o("div",Se,[x(h,{modelValue:g.value,"onUpdate:modelValue":a[0]||(a[0]=A=>g.value=A),integerOnly:"",length:6,onKeydown:B(w,["enter"])},null,8,["modelValue"])])])])]),footer:k(()=>[x(f,{label:"确认绑定",class:"w-full",disabled:!m.value,onClick:w},null,8,["disabled"])]),_:1})):v.value!==null?(I(),R(b,{class:"w-full max-w-sm sm:max-w-md shadow-lg",key:"second-verify"},{header:k(()=>a[8]||(a[8]=[o("div",{class:"text-2xl font-semibold text-center mt-5"},"谷歌登录",-1)])),content:k(()=>[o("div",null,[a[9]||(a[9]=o("div",{class:"text-center mb-2"},"请输入谷歌验证器中的验证码",-1)),o("div",Ne,[x(h,{modelValue:g.value,"onUpdate:modelValue":a[1]||(a[1]=A=>g.value=A),integerOnly:"",length:6,onKeydown:B(O,["enter"])},null,8,["modelValue"])])])]),footer:k(()=>[x(f,{label:"登录",severity:"primary",class:"w-full",disabled:!m.value,onClick:O},null,8,["disabled"])]),_:1})):ee("",!0)])}}});export{Ue as default};
