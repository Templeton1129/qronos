import{s as B}from"./index-C4uR4OqR.js";import{X as b,Y as h,Z as Q,e as L,s as N,i as V}from"./index-B_GZmL3k.js";import{g as $,h as o,u as M,I as E,C as W,N as j,S as O,b as u,i as k,e as w,w as x,A as y,o as a,j as t,d as R}from"./index-DbB14CKm.js";import{Q as X}from"./qrcode.vue.esm-BmvyAcYy.js";const q={class:"h-full w-full flex justify-center items-center p-4 flex-col"},A={class:"flex flex-col items-center justify-center"},D={class:"relative inline-block mb-2"},F={key:0,class:"text-center ml-4 mr-4 text-sm"},z={key:1,class:"text-sm"},H={key:0,class:"text-center mt-2"},ee=$({__name:"bind-wx.page",setup(J){const T=W(),p=o(""),d=o(!1),l=o(null),n=o(null),s=o(""),r=o(""),{localStorageWxtoken:I,userInfo:C}=M();E(()=>{b()===!1&&(localStorage.getItem("xbx-client-uuid")!==null?s.value=localStorage.getItem("xbx-client-uuid")||"":(s.value=h(),localStorage.setItem("xbx-client-uuid",s.value)),r.value=h(),g())});const g=()=>{d.value=!1,s&&r&&(p.value=`https://api.quantclass.cn/user/authorize?client_id=${s.value}&nonce=${r.value}&action=&ignore=0&r=${Math.random()}`,S(),U())},S=()=>{m(),l.value=setTimeout(()=>{d.value=!0,i()},5*60*1e3)},m=()=>{l.value&&(clearTimeout(l.value),l.value=null)},U=()=>{i(),_()},_=async()=>{var v;try{const e=await Q(s.value,r.value);if(e.result===!0&&((v=e==null?void 0:e.data)!=null&&v.token)){const f=e.data.token;I.value=f;const c=await L();if(c.result===!0){C.value=JSON.stringify(c.data),T.replace("/home");return}}}catch(e){console.error("轮询请求失败:",e);return}n.value=setTimeout(_,3e3)},i=()=>{n.value&&(clearTimeout(n.value),n.value=null)};return j(()=>{m(),i()}),O(()=>{m(),i()}),(v,e)=>{const f=N,c=B;return a(),u("div",q,[k(c,{class:"w-full max-w-sm sm:max-w-md py-4 sm:py-8 shadow-lg"},{header:x(()=>e[1]||(e[1]=[t("div",{class:"text-2xl font-semibold text-center"},"微信登录",-1)])),content:x(()=>[t("div",A,[t("div",D,[k(X,{class:"w-50 h-50 sm:w-60 sm:h-60 p-2 rounded-lg bg-white",value:p.value,level:"H","render-as":"svg"},null,8,["value"]),d.value?(a(),R(f,{key:0,class:"absolute inset-0 bg-black/50 backdrop-blur-sm hover:bg-black/60 focus:ring-2 focus:ring-offset-2 focus:ring-black border-0",onClick:e[0]||(e[0]=Y=>g())},{default:x(()=>e[2]||(e[2]=[t("div",{className:"text-white"},[t("i",{class:"pi pi-refresh text-3xl mx-auto mb-4"}),t("div",null,"二维码失效"),t("div",null,"请点击刷新")],-1)])),_:1,__:[2]})):w("",!0)]),y(V)()===!0?(a(),u("div",F," 截图二维码打开微信扫一扫，授权登录后，返回浏览器 ")):(a(),u("div",z,"打开微信，扫描上方二维码登录"))])]),_:1}),y(b)()===!0?(a(),u("div",H," 请在pc浏览器或手机浏览器打开该页面 ")):w("",!0)])}}});export{ee as default};
